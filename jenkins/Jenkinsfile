"pipeline"{
   "agent any
environment"{
      "REGISTRY =""myregistry.example.com""${REGISTRY}/fullstack-frontend:latest""BACKEND_IMAGE =""${REGISTRY}/fullstack-backend:latest"
   }"stages"{
      "stage(""Checkout"")"{
         "steps"{
            "checkout scm"
         }
      }"stage(""Build Frontend"")"{
         "steps"{
            "dir(""frontend"")"{
               "sh""npm install""sh""npm run build""sh""docker build -t ${env.FRONTEND_IMAGE} ."
            }
         }
      }"stage(""Build Backend"")"{
         "steps"{
            "dir(""backend"")"{
               "sh""./gradlew clean bootJar --no-daemon""sh""docker build -t ${env.BACKEND_IMAGE} ."
            }
         }
      }"stage(""Push Images"")"{
         "steps"{
            "withCredentials("[
               "usernamePassword(credentialsId":"docker-creds",
               "usernameVariable":"DOCKER_USER",
               "passwordVariable":"DOCKER_PASS"")"
            ]")"{
               "sh""echo $DOCKER_PASS | docker login -u $DOCKER_USER --password-stdin myregistry.example.com""sh""docker push ${env.FRONTEND_IMAGE}""sh""docker push ${env.BACKEND_IMAGE}"
            }
         }
      }"stage(""Deploy (docker-compose)"")"{
         "steps"{
            "sh""docker-compose -f docker-compose.yml up -d --build"
         }
      }
   }"post"{
      "always"{
         "echo""Pipeline finished"
      }
   }
}
